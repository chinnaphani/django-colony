{% extends "base.html" %}
{% load static %}
{% block content %}
<h2 style="color: #0B294B; margin-bottom: 20px;">🏦 Corpus Fund Records</h2>

<style>
  .corpus-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
    font-family: Arial, sans-serif;
    box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
  }

  .corpus-table thead {
    background-color: #0B294B;
    color: white;
  }

  .corpus-table th, .corpus-table td {
    padding: 12px 16px;
    text-align: left;
  }

  .corpus-table tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  .corpus-table tr:hover {
    background-color: #e1efff;
  }

  .status-paid {
    color: green;
    font-weight: bold;
  }

  .status-unpaid {
    color: red;
    font-weight: bold;
  }

  .mark-btn {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
  }

  .mark-btn:hover {
    background-color: #218838;
  }
</style>

<table class="corpus-table">
  <thead>
    <tr>
      <th>🏡 House</th>
      <th>💰 Amount</th>
      <th>📌 Status</th>
      <th>📅 Paid On</th>
      <th>📄 Receipt</th>
      <th>✅ Action</th>
    </tr>
  </thead>
  <tbody>
    {% for r in records %}
    <tr>
      <td>{{ r.house.house_number }} - {{ r.house.owner_name }}</td>
      <td>₹{{ r.amount }}</td>
      <td>
        {% if r.is_paid %}
          <span class="status-paid">Paid</span>
        {% else %}
          <span class="status-unpaid">Unpaid</span>
        {% endif %}
      </td>
      <td>{{ r.paid_on|default:"—" }}</td>
      <td>{{ r.receipt_number|default:"—" }}</td>
      <td>
        {% if not r.is_paid %}
          <form method="post" action="{% url 'colonybilling:mark_corpus_paid' r.id %}">
            {% csrf_token %}
            <button type="submit" class="mark-btn">Mark as Paid</button>
          </form>
        {% else %}
          <span style="color: gray;">—</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- ✅ SweetAlert2 Toast -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% if messages %}
<script>
  {% for message in messages %}
  Swal.fire({
    icon: 'success',
    title: '{{ message|escapejs }}',
    toast: true,
    position: 'top-end',
    showConfirmButton: false,
    timer: 2000,
    background: '#f0f0f0',
    color: '#0B294B'
  });
  {% endfor %}
</script>
{% endif %}
{% endblock %}
